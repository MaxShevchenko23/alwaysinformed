<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Article Sandbox Create</title>
</head>

<body>
    <header class="m-lg-4">Article creating page</header>
    <form>
        <label class="m-2" for="title">Title</label><br>
        <input class="input-group-text m-lg-2" type="text" id="title" name="title" value="title" required minlength="5"><br><br>

        <label class="m-2" for="author">Author ID</label><br>
        <input class="input-group-text" type="text" id="author" name="author" required="required">

        <button class="btn-info m-2" type="button" onclick="getName()">Check</button>
        <span class="text-lg-start" id="authorNameField">test</span><br><br>

        <label for="category">Category</label><br>
        <select class="form-select-sm m-2" name="categories" id="categories">
            
        </select><br><br>

        <label for="image">Image URL</label><br>
        <input class="input-group-text m-2" type="text" id="image" name="image" value="image" required minlength="5"><br><br>

        <label for="short">Short description</label><br>
        <input class="input-group-text m-2" type="text" id="short" name="short" value="short" required minlength="10"><br><br>

        <label for="content">Content</label><br>
        <input type="text" class="input-group-text m-2" id="content" name="content" value="content" required minlength="20"><br><br>

        <button class="btn-success w-25 m-2" type="button" onclick="postData()">Save</button>
      </form> 
</body>
<script>
    

    const selector = document.querySelector('select');
    const title = document.getElementById('title').value;
    const image = document.getElementById('image').value;
    const short = document.getElementById('short').value;
    const content = document.getElementById('content').value;
    const authorId = document.getElementById('author');
    
    let categories;
    let categoryId;

    (function(){



        fetch('https://localhost:7115/Category')
        .then(response => response.json())
        .then(data => {
        categories = data;
        console.log(categories);

        categories.forEach(cat => {
            selector.innerHTML += `<option value='${cat.categoryId}'>${cat.categoryName}</option>`;
        });
    })
    .catch(() => console.log('Fetching failed(category)'));




    })();

    function getCategoryById(categoryId){
        const categoryFound = categories.find(cat=>cat.categoryId = categoryId);

        console.log(categoryFound);
        if(categoryFound){
            return categoryFound.categoryName;
        }
        else{
            return "Category Not Found"
        }
    }

    //change inner code for 'POST' method
    function postData(){
      
        const article = 
            {
                "authorId": parseInt(authorId.value, 10),
                "content": content,
                "categoryId": parseInt(selector.value, 10),
                "image": image,
                "shortDescription": short,
                "title": title,
                "articleStatus": 0,
                "adminEmail": "string",
                "articleAdminComment": "string"
            };

        console.log(article);

        const requestOptions = {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(article)
                };

        fetch('https://localhost:7115/ArticleSandbox', requestOptions)
        .catch(()=> console.log('posting failed'));
    }

    function getName() {
        const authorId = document.getElementById('author').value;
        const testField = document.getElementById('authorNameField');

        fetch(`https://localhost:7115/Author/id?id= + ${authorId}`)
        .then(response => response.json())
        .then(author => {
            testField.innerText = `${author.firstName} ${author.lastName}`
        });
    }
</script>
</html>