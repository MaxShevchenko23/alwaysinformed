<!doctype html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="../css/article.css">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.tiny.cloud/1/ury8b9gyx5sbknq40l8lrqhx1v8556ve0vhztxmkslkrk5on/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
        <script src="../js/index.js"></script>
        <script src="../js/tokenProccessing.js"></script>

    </head>
    
    <body>
        <header>
            <!-- Fixed navbar -->
            <nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color: #001A37;">
              <a class="navbar-brand" href="#">Always Informed</a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home <span class="sr-only"></span></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Technology</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Science</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Sports</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Health</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="" id="profile">Log in</a>
                  </li>
                </ul>
                <form class="form-inline mt-2 mt-md-0">
                  <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
                  <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </form>
              </div>
            </nav>
        </header>
        <main>
            <div id="article-name" class="mt-5">
                <h1>Article name</h1>
            </div>
            <div id="article-metainfo">
                <div class="date">Published: 23.09.2023 12:58</div>
                <div class="author">Author: Max Shevchenko</div>
            </div>
            <div class="m-5" id="article-image">
                <img class="article-image w-75" src="">
            </div>
            <div class="m-2" id="article-content">
                <article>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                </article><br>

                <article>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                </article><br>

                <article>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                </article><br>

                            
                <article>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                </article><br>

                <article>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                </article><br>

                <article>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                    Lorem ipsum dolor, sit amet consectetur adipisicing elit. Praesentium ratione, labore deserunt ut beatae nam et quae, necessitatibus perspiciatis placeat repudiandae commodi ex illo odio illum quos, ad magni quisquam?
                </article><br>
            </div>
           
        </main>

        <script>
            tinymce.init({
              selector: 'textarea',
              plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
              toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
            });
        </script>
        
        <textarea id="area" class="m-2">
            Great article!
        </textarea>
        
        <button value="Leave a comment" class=" m-2 btn btn-success" onclick="leaveComment()">Leave a comment</button>
        <button value="Leave a comment" class=" m-2 btn btn-outline-danger" onclick="likeArticle()" id="Like">Like this article</button>

        <h3 class="m-1">Comments</h3>
        <section id="comments">               
        </section>
        <footer>
            <div id="footer">
                <div class="footer_buttons">
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                    <div class="footer_button">
                        <a>Button</a>
                    </div>
                </div>
                
                <div class="copy">
                    <span> &copy; FuryDevelop 2023</span>
                </div>
            </div>
        </footer>
        <script>
            let articleId;
            let comments;
            
            const commentSection = document.querySelector('section');
            (function() {
                checkCredentials();
                var location = window.location.search;
                console.log(location);
                var urlParams = new URLSearchParams(location);
                console.log(urlParams);
                var data = urlParams.get("article-url");
                console.log(data.toString());
                
                fetch('https://localhost:7115/api/user/articles/url?url=' + data.toString())
                .then(response => response.json())
                .then(data => {
                    
                    articleId = data.articleId;
                    console.log(articleId);

                    const title = document.querySelector('#article-name h1');
                    const scontent = document.getElementById('article-content');
                    
                    const publicationDate = document.querySelector('#article-metainfo .date');

                    const image = document.querySelector('#article-image img');
                    
                    title.innerHTML = data.title;
                    
                    scontent.innerHTML = data.content;  
                    image.src = data.image.toString();
                    
                    publicationDate.innerHTML = 'Published ' + data.publicationDate.replace('T', ' ');

                    const author = document.querySelector('#article-metainfo .author');
                    author.innerHTML = 'Author: ' + data.firstName + ' ' + data.lastName;

                    const comments = data.comments;

                    comments.forEach(comment => {
                        commentSection.innerHTML += `<div class="comment m-3 border">
                                                            <strong class="m-2"> ${comment.userName} </strong>
                                                            <p class="m-1 w-100"> ${comment.text} </p>
                                                        </div>`
                    });
                });
            })()

            function leaveComment(){
                console.log(tinymce.activeEditor.getContent());

                let body = {
                    "text": tinymce.activeEditor.getContent(),
                    "userName": document.getElementById('profile').innerText,
                    "articleId": articleId
                }
                const requestOptions = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json',
                               'Origin':'test'},
                    body: JSON.stringify(body) 
                };

                fetch('https://localhost:7115/api/user/comms/add',requestOptions)
                .then(response => {
                    if(response.ok){
                        window.location.reload();
                    }
                })
                .catch(e=>console.log(e));
            }
            
            function likeArticle() {
                let body = {
                    "userId": parseTokenData(getCookie()).id,
                    "articleId": articleId
                }
                const requestOptions = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json',
                               'Origin':'test'},
                    body: JSON.stringify(body) 
                };
                console.log(body);
                fetch('https://localhost:7115/api/user/favs/add',requestOptions)
                .then(response => {
                    if(response.ok){
                       var button =  document.getElementById('Like');
                       button.innerText = 'Liked';
                       button.setAttribute('onclick','')
                    }
                })
                .catch(e=>console.log(e));
            }


        </script>
    </body>
</html>